<?php

/**
 * CounterTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class CounterTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object CounterTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Counter');
    }

    public function getCurrentData($culture)
    {
    	return $this->createQuery('a')->
    		select('a.initial_number, a.flow, '.
    			   //'@margin := TIMESTAMPDIFF(SECOND, a.initial_date, NOW()) AS margin, '.
    			   //'FLOOR(a.initial_number + @margin) AS planted_trees, '.
    			'FLOOR(a.initial_number + TIMESTAMPDIFF(SECOND, a.initial_date, NOW())*a.flow) AS planted_trees, '.
    			'FLOOR((1 - TIMESTAMPDIFF(SECOND, a.initial_date, NOW())*a.flow + '.
    				'FLOOR(TIMESTAMPDIFF(SECOND, a.initial_date, NOW())*a.flow))*(1000/a.flow)) AS delay, '.
    			'ROUND(1000/a.flow) AS interval, '.
    			't.slogan_part1, t.slogan_part2, t.donation_text')->
    		innerJoin('a.Translation t')->
    		where("t.lang=?", $culture)->
    		orderBy('initial_date ASC')->
    		limit(1)->
    		execute();
    }
}