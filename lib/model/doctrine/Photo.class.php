<?php

/**
 * Photo
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    grainedevie
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7691 2011-02-04 15:43:29Z jwage $
 */
class Photo extends BasePhoto
{

	//public static $PHOTODIR = "c:/ma1ig/web/uploads/photo/";

	/*public function __construct()
	{
		parent::__construct();
		if(!isset(Photo::$PHOTODIR))
			Photo::$PHOTODIR = sfConfig::get('sf_upload_dir').'/photo/';
	}*/
	
	public function getPhotoPage()
	{
		$q = Doctrine_Query::create()
			->from('photo p');
		return ($q);
	}

	public function getPhotoThumbnailGrandeFolder()
	{
		return $this->getPhotoUploadFolder().'thumbnailGrande/';
	}

	public function getPhotoThumbnailFolder()
	{
		return $this->getPhotoUploadFolder().'thumbnail/';
	}

	public function getPhotoUploadFolder()
	{
		return sfConfig::get('sf_upload_dir').'/photo/';
	}

	public function create_thumbnail($filename, $directory, $height, $width)
	{
		$thumbnail = new sfThumbnail($width, $height);
	    $thumbnail->loadFile($this->getPhotoUploadFolder().$filename);
	    $thumbnail->save($directory.$filename);	
	}

	public function save(Doctrine_Connection $conn = null)
	{
		$filename = $this->getUrl();		
		// Create the thumbnail
		if(isset($filename)){
			$this->create_thumbnail($filename, $this->getPhotoThumbnailFolder(), 150, 150);
			$this->create_thumbnail($filename, $this->getPhotoThumbnailGrandeFolder(), 1024, 768);	    
		}
		return parent::save($conn);
	}

}
